## 1

TCP协议如何保证数据的可靠传输？

> 可靠传输即保证数据不丢包, 如果丢包需要让发送方重传
>
> 
>
> 1.让发送方知道丢包: 接收方接收到数据包向发送方发送确认(ACK), 发送方设置定时器, 若规定时间没接收到确认则意味着丢包
>
> 2.丢包后发送方重发, 接收方区分重传包与新包: 发送方每次发送数据都会附带一个序号
>
> 3.解决不按序到达的确认问题: 接收方发送确认时包含 SEQ 信息







## 2

为什么TCP需要三次握手？两次握手为什么不行？

> 因为 TCP 是一个全双工通信管道, 存在两条管道, 每条管道都有读写两端, 通信前需要打开两条管道的读写端; 
>
>  
>
> 对于一个线程来说自己能收到信息, 意味着对方的写端和自己的读端正常开启; 自己能发送信息意味着自己的写端正常开启; 关键是如何确定对方的读端正常开启
>
>  
>
> 其中 客户端C 给 服务端S 发送一条信息, 若能收到 服务端S 的确认 则 C 可以确定 S 端读正常开启, 即 C ---------------> S, S --------------> C; 
>
> 若 服务端S 给 客户端C 发送一条信息, 若能收到 客户端C 的确认, 则 S 可以确认 C 端读正常开启, 即 S ---------------> C, C ---------------> S;
>
>   
>
> 其中 两个 S -----------> C 可以合并为一次通信, 则最少进行三次通信可以使通信双方都确定管道两端读写已打开







## 3

通过wireshark抓包分析TCP三次握手过程，

尝试解读TCP协议的每一个字段，截图显示抓包结果。

![image-20230819191521776](https://xiao060.oss-cn-hangzhou.aliyuncs.com/md/image-20230819191521776.png)

![](https://xiao060.oss-cn-hangzhou.aliyuncs.com/md/202308191916743.png)

- Source Port: 源端口 (16b)
- Destination Port: 目的端口 (16b)
- Sequence Number: 数据包第1个字节序列号 (32b)
- Acknowledgment Number: 确认序列号 (32b), 即期望收到的数据的开始序列号, 也等于已经收到的数据的字节长度加1
- Data Offset (4b): 首部长度, 以 4B 为单位
- 标志符 (12b)
  - 保留 (3b): 0
  - Nonce
  - CWR (Congestion Window Reduced)
  - ECN-Echo
  - URG (Urgent): 高优先级数据包，紧急指针字段有效
  - ACK (Acknowledgment): 确认序列号
  - PSH (Push): 带有PUSH标志的数据，指示接收方应该尽快将这个报文段交给应用层而不用等待缓冲区装满
  - RST (Reset): 出现严重差错。需要重新建立TCP连接, 还可以用于拒绝非法的报文段和拒绝连接请求
  - SYN: 连接请求或连接接受请求，用于建立连接和使顺序号同步
  - FIN: 发送方没有数据要传输了，要求释放连接
- Window (16b): 接收窗口大小, 用于流量控制
- Checksum (16b): 校验和
- Urgent Pointer (16b): 紧急指针
- 选项
- 数据





